# Configuration Netlify optimisée pour la production
[build]
  command = "npm run build"
  functions = "netlify/functions"
  publish = ".next"
  environment = { NODE_ENV = "production", NEXT_TELEMETRY_DISABLED = "1" }

# Configuration des plugins
[[plugins]]
  package = "@netlify/plugin-nextjs"

[[plugins]]
  package = "@netlify/plugin-functions-install-core"

# Configuration des en-têtes HTTP
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer-when-downgrade"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), interest-cohort=()"
    Cache-Control = "public, max-age=3600"

# Configuration des en-têtes spécifiques pour les ressources statiques
[[headers]]
  for = "/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Redirection pour assurer que toutes les requêtes vont vers HTTPS
[[redirects]]
  from = "http://*"
  to = "https://:splat"
  status = 301
  force = true

# Options pour les fonctions Netlify
[functions]
  # Augmenter le timeout pour les fonctions serverless
  timeout = 30
  # Augmenter la limite de mémoire
  memory = 1024
  # Activer les logs détaillés
  debug = true
  # Dossier des fonctions Node.js
  directory = "netlify/functions"
  # Inclure les fichiers Node.js
  node_bundler = "esbuild"

# IMPORTANT: Supprimer la redirection SPA qui conflit avec Next.js
# [[redirects]]
#  from = "/*"
#  to = "/index.html"
#  status = 200

# Redirection pour les routes d'API - supprimée car elle peut entrer en conflit avec Next.js
# [[redirects]]
#  from = "/api/*"
#  to = "/.netlify/functions/api/:splat"
#  status = 200
#  force = true
